<definitions id="definitions"
             targetNamespace="http://activiti.org/bpmn20"
             xmlns:activiti="http://activiti.org/bpmn"
             xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL">

    <process id="financialReport" name="Monthly financial report reminder process">

        <extensionElements>
            <activiti:executionListener
                    expression="${cmMuleActivitiListener.sendMessage('vm://activiti-flow', 'Grateful Dead',
                            'bandResults', execution)}"
                    event="start" />
        </extensionElements>

        <startEvent id="theStart" />

        <sequenceFlow id='flow1' sourceRef='theStart' targetRef='writeReportTask' >
            <extensionElements>
                <activiti:executionListener
                        expression="${cmMuleActivitiListener.sendMessage('vm://activiti-flow', 'Allman Bros. Band',
                            'bandResults', execution)}"/>
            </extensionElements>
        </sequenceFlow>

        <userTask id="writeReportTask" name="Write monthly financial report" >
            <documentation>
                Write monthly financial report for publication to shareholders.
            </documentation>
            <extensionElements>
                <activiti:executionListener expression="${cmMuleActivitiListener.sendMessage('vm://activiti-flow', 'furthur!', execution)}" event="start"/>
            </extensionElements>
            <potentialOwner>
                <resourceAssignmentExpression>
                    <formalExpression>accountancy</formalExpression>
                </resourceAssignmentExpression>
            </potentialOwner>

        </userTask>

        <sequenceFlow id='flow2' sourceRef='writeReportTask' targetRef='verifyReportTask' />

        <userTask id="verifyReportTask" name="Verify monthly financial report" >
            <documentation>
                Verify monthly financial report composed by the accountancy department.
                This financial report is going to be sent to all the company shareholders.
            </documentation>
            <potentialOwner>
                <resourceAssignmentExpression>
                    <formalExpression>management</formalExpression>
                </resourceAssignmentExpression>
            </potentialOwner>
        </userTask>

        <sequenceFlow id='flow3' sourceRef='verifyReportTask' targetRef='theEnd' />

        <endEvent id="theEnd" />

    </process>

</definitions>
