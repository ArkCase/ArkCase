<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="
            http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

        <changeSet id="01-tag-tables" author="marst">
            <createTable tableName="acm_tag">
                <column name="cm_tag_id" type="NUMBER(32,0)">
                    <constraints primaryKey="true" primaryKeyName="pk_cm_tag_id"/>
                </column>

                <column name="cm_file_id" type="NUMBER(32,0)"/>

                <column name="cm_tag_text" type="VARCHAR(256)">
                    <constraints nullable = "false"/>
                </column>

                <column name="cm_tag_creator" type="VARCHAR(128)">
                    <constraints nullable="false"/>
                </column>

                <column name="cm_tag_modified" type="TIMESTAMP WITH TIME ZONE">
                    <constraints nullable="false"/>
                </column>

                <column name="cm_tag_modifier" type="VARCHAR(128)">
                    <constraints nullable="false"/>
                </column>

                <column name="cm_tag_created" type="TIMESTAMP WITH TIME ZONE">
                    <constraints nullable="false"/>
                </column>

                <column name="cm_parent_object_id" type="NUMBER(32,0)">
                    <constraints nullable = "false"/>
                </column>

                <column name="cm_parent_object_type" type="VARCHAR(128)">
                    <constraints nullable = "false"/>
                </column>
            </createTable>
        </changeSet>

    <changeSet id="2-tag-tables" author="marst">

        <dropColumn tableName="acm_tag" columnName="cm_file_id"/>
        <dropColumn tableName="acm_tag" columnName="cm_tag_type"/>
        <dropColumn tableName="acm_tag" columnName="cm_parent_object_id"/>
        <dropColumn tableName="acm_tag" columnName="cm_parent_object_type"/>


        <addColumn tableName="acm_tag">
            <column name="cm_tag_description" type="VARCHAR(1024)">
                <constraints nullable="true"/>
            </column>
        </addColumn>

        <addColumn tableName="acm_tag">
            <column name="cm_tag_name" type="VARCHAR(256)">
                <constraints nullable="true"/>
            </column>
        </addColumn>

        <createTable tableName="acm_associated_tag">
            <column name="cm_associated_tag_id" type="NUMBER(32,0)">
                <constraints primaryKey="true" primaryKeyName="pk_cm_associated_tag_id"/>
            </column>

            <column name="cm_tag_id" type="NUMBER(32,0)"/>

            <column name="cm_associated_tag_creator" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>

            <column name="cm_associated_tag_created" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>

            <column name="cm_parent_object_id" type="NUMBER(32,0)">
                <constraints nullable = "false"/>
            </column>

            <column name="cm_parent_object_type" type="VARCHAR(128)">
                <constraints nullable = "false"/>
            </column>
        </createTable>

        <createIndex tableName="acm_associated_tag" unique="true" indexName="idx_tag_object_type">
            <column name="cm_tag_id" type="NUMBER(32,0)"/>
            <column name="cm_object_id" type="NUMBER(32,0)"/>
            <column name="cm_object_type" type="VARCHAR(1024)"/>
        </createIndex>

    </changeSet>

</databaseChangeLog>
