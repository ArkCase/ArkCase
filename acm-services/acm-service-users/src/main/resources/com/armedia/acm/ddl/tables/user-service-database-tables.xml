<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="
            http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="01-user-service-tables" author="dmiller">
        <createTable tableName="acm_user">
            <column name="cm_user_id" type="VARCHAR(1024)">
                <constraints nullable="false" />
            </column>
            <column name="cm_user_directory_name" type="VARCHAR(1024)">
                <constraints nullable="false" />
            </column>
            <column name="cm_full_name" type="VARCHAR(1024)"/>
            <column name="cm_user_created" type="DATE">
            </column>
            <column name="cm_user_modified" type="DATE">
                <constraints nullable="false" />
            </column>
            <column name="cm_user_state" type="VARCHAR(256)">
                <constraints nullable="false" />
            </column>
        </createTable>

        <createTable tableName="acm_user_role">
            <column name="cm_user_id" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_role_name" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_user_role_state" type="VARCHAR(256)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <createTable tableName="acm_role">
            <column name="cm_role_name" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey
                tableName="acm_user"
                columnNames="cm_user_id, cm_user_directory_name"
                constraintName="pk_acm_user_id"/>
        <addPrimaryKey
                tableName="acm_user_role"
                columnNames="cm_role_name, cm_user_id"
                constraintName="pk_acm_user_role"/>
        <addPrimaryKey
                tableName="acm_role"
                columnNames="cm_role_name"
                constraintName="pk_acm_role_name"/>
    </changeSet>

    <changeSet id="02-user-service-drop-directory-name" author="dmiller">
        <dropPrimaryKey tableName="acm_user"/>
        <addPrimaryKey tableName="acm_user" columnNames="cm_user_id" constraintName="pk_acm_user"/>
    </changeSet>

    <changeSet id="03-add-first-and-last-name" author="dmiller">
        <addColumn tableName="acm_user">
            <column name="cm_first_name" type="VARCHAR(1024)"/>
            <column name="cm_last_name" type="VARCHAR(1024)"/>
        </addColumn>
        <createIndex tableName="acm_user" indexName="idx_user_last_name">
            <column name="cm_last_name"/>
        </createIndex>
    </changeSet>

    <changeSet id="04-user-service-add-role-type" author="dmiller">
        <addColumn tableName="acm_role">
            <column name="cm_role_type" type="VARCHAR(1024)"/>
        </addColumn>
    </changeSet>

    <changeSet id="05-user-service-add-role-type-lookup-table" author="dmiller">
        <createTable tableName="acm_role_type_lu">
            <column name="cm_id" type="NUMBER(32,0)">
                <constraints
                        nullable="false"
                        primaryKey="true"
                        primaryKeyName="pk_role_type"/>
            </column>
            <column name="cm_value" type="VARCHAR(4000)" >
                <constraints nullable="false" unique="true" uniqueConstraintName="uk_role_type"/>
            </column>
            <column name="cm_order" type="NUMBER(32,0)">
                <constraints nullable="false" unique="true" uniqueConstraintName="uk_role_type_order"/>
            </column>
            <column name="cm_status" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_created" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="cm_creator" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_modified" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="cm_modifier" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <insert tableName="acm_role_type_lu">
            <column name="cm_id" valueComputed="SEQ_GEN_IDENTITY.NEXTVAL"/>
            <column name="cm_value" value="LDAP_GROUP"/>
            <column name="cm_order" valueNumeric="0"/>
            <column name="cm_status" value="ACTIVE"/>
            <column name="cm_created" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_creator" valueComputed="USER"/>
            <column name="cm_modified" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_modifier" valueComputed="USER"/>
        </insert>
        <insert tableName="acm_role_type_lu">
            <column name="cm_id" valueComputed="SEQ_GEN_IDENTITY.NEXTVAL"/>
            <column name="cm_value" value="APPLICATION_ROLE"/>
            <column name="cm_order" valueNumeric="1"/>
            <column name="cm_status" value="ACTIVE"/>
            <column name="cm_created" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_creator" valueComputed="USER"/>
            <column name="cm_modified" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_modifier" valueComputed="USER"/>
        </insert>
    </changeSet>

    <changeSet id="06-role-type-notnull" author="dmiller">
        <addNotNullConstraint tableName="acm_role" columnName="cm_role_type" defaultNullValue="APPLICATION_ROLE"/>
    </changeSet>

    <changeSet id="07-users-add-participant-table" author="dmiller">
        <createTable tableName="acm_participant">
            <column name="cm_participant_id" type="NUMBER(32,0)">
                <constraints primaryKey="true" primaryKeyName="pk_cm_participant"/>
            </column>
            <column name="cm_object_type" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_object_id" type="NUMBER(32,0)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_participant_type" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_participant_ldap_id" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_participant_created" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="cm_participant_creator" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_participant_modified" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="cm_participant_modifier" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <createIndex tableName="acm_participant" indexName="idx_acm_participant_object">
            <column name="cm_object_id"/>
            <column name="cm_object_type"/>
        </createIndex>
        <createIndex tableName="acm_participant" indexName="idx_acm_participant_user">
            <column name="UPPER(cm_participant_id)"/>
        </createIndex>
    </changeSet>

     <changeSet id="08-add-email-column-to-user-table" author="marst">
         <addColumn tableName="acm_user">
             <column name="cm_mail" type="VARCHAR(512)"/>
         </addColumn>
     </changeSet>
</databaseChangeLog>