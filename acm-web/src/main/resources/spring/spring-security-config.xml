<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/security"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:beans="http://www.springframework.org/schema/beans"
       xsi:schemaLocation="
           http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-4.1.xsd
           http://www.springframework.org/schema/security
           http://www.springframework.org/schema/security/spring-security-3.2.xsd">

	<!--
		Configure Spring Security.
	-->

    <!-- The login page itself, along with the JavaScript and images that
         appear on the login page, do not have to be protected.  -->
    <http security="none" pattern="/login" />
    <http security="none" pattern="/login.html" />
    <http security="none" pattern="/login.jsp" />
    <http security="none" pattern="/assets/css/login.css"/>
    <http security="none" pattern="/resources/**" />
    <http security="none" pattern="/branding/**"/>
    <http security="none" pattern="/external/**"/>
    <!-- All lib are public, no security needed-->
    <http security="none" pattern="/lib/**"/>

    <!-- acmAuthenticationManager, acmLogoutSuccessHandler, and acmAuthenticationDetailsFactory are defined
         in spring-library-user-login.xml -->

    <http
            auto-config="true"
            use-expressions="true"
            authentication-manager-ref="acmAuthenticationManager">
        <intercept-url pattern="/**" access="isAuthenticated()"/>
        <http-basic/>
        <custom-filter ref="acmBasicAndTokenAuthenticationFilter" before="BASIC_AUTH_FILTER"/>
        <custom-filter ref="corsFilter" after="PRE_AUTH_FILTER"/>
		<form-login
                login-page="/login"
                default-target-url="/home.html#!/welcome"
                authentication-details-source-ref="acmAuthenticationDetailsFactory"
                authentication-failure-url="/login?login_error=1"
                authentication-success-handler-ref="acmLoginSuccessHandler"/>
		<logout
                logout-url="/logout"
                delete-cookies="JSESSIONID"
                success-handler-ref="acmLogoutSuccessHandler"
                invalidate-session="true"/>
        <session-management invalid-session-url="/login?login_error=1">
            <!--this will throw error to 3rd login attempt -->
            <!--<concurrency-control max-sessions="3" error-if-maximum-exceeded="true" /> -->
        </session-management>
	</http>
   
</beans:beans>
