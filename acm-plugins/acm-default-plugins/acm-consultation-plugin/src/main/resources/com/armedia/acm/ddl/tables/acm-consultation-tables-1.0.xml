<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="
            http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <property name="consultationNumberLength" value="1024" dbms="postgresql,oracle"/>
    <property name="consultationNumberLength" value="255" dbms="mysql,mssql"/>

    <changeSet id="01-consultation-add-acm-consultation-table" author="vladimir.cherepnalkovski"
               dbms="oracle,postgresql,mssql">
        <createTable tableName="acm_consultation">
            <column name="cm_consultation_id" type="${idType}">
                <constraints primaryKeyName="pk_acm_consultation" primaryKey="true"/>
            </column>
            <column name="cm_consultation_number" type="VARCHAR(${consultationNumberLength})">
                <constraints unique="true" uniqueConstraintName="uk_consultation_number" nullable="false"/>
            </column>
            <column name="cm_consultation_type" type="VARCHAR(4000)"/>
            <column name="cm_consultation_title" type="VARCHAR(4000)"/>
            <column name="cm_consultation_status" type="VARCHAR(4000)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_consultation_details" type="CLOB">
                <constraints nullable="true"/>
            </column>
            <column name="cm_consultation_details_summary" type="CLOB">
                <constraints nullable="true"/>
            </column>
            <column name="cm_consultation_incident_date" type="${timestampType}">
                <constraints nullable="true"/>
            </column>
            <column name="cm_consultation_created" type="${timestampType}">
                <constraints nullable="false"/>
            </column>
            <column name="cm_consultation_creator" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_consultation_modified" type="${timestampType}">
                <constraints nullable="false"/>
            </column>
            <column name="cm_consultation_modifier" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_consultation_closed" type="DATE"/>
            <column name="cm_consultation_disposition" type="VARCHAR(4000)"/>
            <column name="cm_consultation_priority" type="VARCHAR(1024)"/>
            <column name="cm_consultation_external_flag" type="BOOLEAN" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="cm_object_type" type="VARCHAR(100)" defaultValue="CONSULTATION">
                <constraints nullable="false"/>
            </column>
            <column name="cm_class_name" type="VARCHAR(400)"/>
            <column name="cm_due_date" type="${timestampType}">
                <constraints nullable="true"/>
            </column>
            <column name="cm_consultation_restricted_flag" type="VARCHAR(32)" defaultValue="false">
                <constraints nullable="false"/>
            </column>
            <column name="cm_container_id" type="${fkIdType}"/>
            <column name="cm_responsible_organization" type="VARCHAR(100)"/><!--
            <column name="cm_queue_id" type="${fkIdType}">
                <constraints foreignKeyName="fk_queue_id" referencedColumnNames="cm_queue_id"
                             referencedTableName="acm_queue"/>
            </column>-->
            <column name="cm_queue_enter_date" type="${timestampType}"/>
            <column name="cm_response_due_date" type="${timestampType}"/>
            <column name="cm_previous_queue_id" type="${idType}"/>
            <column name="cm_security_field" type="VARCHAR(255)" defaultValue="Open"/>
            <column name="cm_legacy_system_id" type="VARCHAR(255)"/>
            <column name="cm_consultation_denied_flag" type="VARCHAR(10)" defaultValue="false"/>
        </createTable>
    </changeSet>

    <changeSet id="02-consultation-add-acm-consultation-table" author="vladimir.cherepnalkovski" dbms="mysql">
        <createTable tableName="acm_consultation">
            <column name="cm_consultation_id" type="${idType}">
                <constraints primaryKeyName="pk_acm_consultation" primaryKey="true"/>
            </column>
            <column name="cm_consultation_number" type="VARCHAR(${consultationNumberLength})">
                <constraints unique="true" uniqueConstraintName="uk_consultation_number" nullable="false"/>
            </column>
            <column name="cm_consultation_type" type="VARCHAR(4000)"/>
            <column name="cm_consultation_title" type="VARCHAR(4000)"/>
            <column name="cm_consultation_status" type="VARCHAR(4000)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_consultation_details" type="CLOB">
                <constraints nullable="true"/>
            </column>
            <column name="cm_consultation_details_summary" type="CLOB">
                <constraints nullable="true"/>
            </column>
            <column name="cm_consultation_incident_date" type="${timestampType}"
                    defaultValueComputed="${timestampFunction}">
                <constraints nullable="true"/>
            </column>
            <column name="cm_consultation_created" type="${timestampType}" defaultValueComputed="${timestampFunction}">
                <constraints nullable="false"/>
            </column>
            <column name="cm_consultation_creator" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_consultation_modified" type="${timestampType}" defaultValueComputed="${timestampFunction}">
                <constraints nullable="false"/>
            </column>
            <column name="cm_consultation_modifier" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_consultation_closed" type="DATE"/>
            <column name="cm_consultation_disposition" type="VARCHAR(4000)"/>
            <column name="cm_consultation_priority" type="VARCHAR(1024)"/>
            <column name="cm_consultation_external_flag" type="BOOLEAN" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="cm_object_type" type="VARCHAR(100)" defaultValue="CONSULTATION">
                <constraints nullable="false"/>
            </column>
            <column name="cm_class_name" type="VARCHAR(400)"/>
            <column name="cm_due_date" type="${timestampType}" defaultValueComputed="${timestampFunction}">
                <constraints nullable="true"/>
            </column>
            <column name="cm_consultation_restricted_flag" type="VARCHAR(32)" defaultValue="false">
                <constraints nullable="false"/>
            </column>
            <column name="cm_container_id" type="${fkIdType}"/>
            <column name="cm_responsible_organization" type="VARCHAR(100)"/><!--
            <column name="cm_queue_id" type="${fkIdType}">
                <constraints foreignKeyName="fk_queue_id" referencedColumnNames="cm_queue_id"
                             referencedTableName="acm_queue"/>
            </column>-->
            <column name="cm_queue_enter_date" type="${timestampType}" defaultValueComputed="${timestampFunction}"/>
            <column name="cm_response_due_date" type="${timestampType}" defaultValueComputed="${timestampFunction}"/>
            <column name="cm_previous_queue_id" type="${idType}"/>
            <column name="cm_security_field" type="VARCHAR(255)" defaultValue="Open"/>
            <column name="cm_legacy_system_id" type="VARCHAR(255)"/>
            <column name="cm_consultation_denied_flag" type="VARCHAR(10)" defaultValue="false"/>
        </createTable>
    </changeSet>

    <changeSet id="03-consultation-add-acm_consultation-id" author="vladimir.cherepnalkovski">
        <createTable tableName="acm_consultation_id">
            <column name="cm_seq_num" type="${idType}"/>
            <column name="cm_seq_name" type="VARCHAR(255)"/>
        </createTable>
        <insert tableName="acm_consultation_id">
            <column name="cm_seq_num" value="100"></column>
            <column name="cm_seq_name" value="acm_consultation"></column>
        </insert>
    </changeSet>

    <changeSet id="04-create-index-column-title" author="vladimir.cherepnalkovski" dbms="oracle,postgresql,mssql">
        <createIndex tableName="acm_consultation" indexName="idx_consultation_title">
            <column name="cm_consultation_title"/>
        </createIndex>
    </changeSet>

    <changeSet id="05-create-index-column-title" author="vladimir.cherepnalkovski" dbms="mysql">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists tableName="acm_consultation" columnNames="cm_consultation_title"/>
            </not>
        </preConditions>
        <createIndex tableName="acm_consultation" indexName="idx_consultation_title">
            <column name="cm_consultation_title (128)"/>
        </createIndex>
    </changeSet>

    <changeSet id="06-consultation-add-acm_change_consultation_status-id" author="vladimir.cherepnalkovski">
        <createTable tableName="acm_change_consultation_status_id">
            <column name="cm_seq_num" type="${idType}"/>
            <column name="cm_seq_name" type="VARCHAR(255)"/>
        </createTable>
        <insert tableName="acm_change_consultation_status_id">
            <column name="cm_seq_num" value="100"></column>
            <column name="cm_seq_name" value="acm_change_consultation_status"></column>
        </insert>
    </changeSet>

    <changeSet id="07-consultation-add-change-consultation-status-table" author="vladimir.cherepnalkovski"
               dbms="oracle,postgresql,mssql">
        <createTable tableName="acm_change_consultation_status">
            <column name="cm_change_consultation_status_id" type="${idType}">
                <constraints primaryKeyName="pk_change_consultation_status" primaryKey="true"/>
            </column>
            <column name="cm_consultation_id" type="${fkIdType}">
                <constraints nullable="false"/>
            </column>
            <column name="cm_change_consultation_status_status" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_object_type" type="VARCHAR(100)" defaultValue="CHANGE_CONSULTATION_STATUS">
                <constraints nullable="false"/>
            </column>
            <column name="cm_change_consultation_status_created" type="${timestampType}">
                <constraints nullable="false"/>
            </column>
            <column name="cm_change_consultation_status_creator" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_change_consultation_status_modified" type="${timestampType}">
                <constraints nullable="false"/>
            </column>
            <column name="cm_change_consultation_status_modifier" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint baseTableName="acm_change_consultation_status" baseColumnNames="cm_consultation_id"
                                 constraintName="fk_change_consultation_status_consultation_id"
                                 referencedTableName="acm_consultation"
                                 referencedColumnNames="cm_consultation_id"
                                 deferrable="${deferrable}" initiallyDeferred="${initially.deferred}"/>
    </changeSet>

    <changeSet id="08-consultation-add-change-consultation-status-table" author="vladimir.cherepnalkovski" dbms="mysql">
        <createTable tableName="acm_change_consultation_status">
            <column name="cm_change_consultation_status_id" type="${idType}">
                <constraints primaryKeyName="pk_change_consultation_status" primaryKey="true"/>
            </column>
            <column name="cm_consultation_id" type="${fkIdType}">
                <constraints nullable="false"/>
            </column>
            <column name="cm_change_consultation_status_status" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_object_type" type="VARCHAR(100)" defaultValue="CHANGE_CONSULTATION_STATUS">
                <constraints nullable="false"/>
            </column>
            <column name="cm_change_consultation_status_created" type="${timestampType}"
                    defaultValueComputed="${timestampFunction}">
                <constraints nullable="false"/>
            </column>
            <column name="cm_change_consultation_status_creator" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_change_consultation_status_modified" type="${timestampType}"
                    defaultValueComputed="${timestampFunction}">
                <constraints nullable="false"/>
            </column>
            <column name="cm_change_consultation_status_modifier" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint baseTableName="acm_change_consultation_status" baseColumnNames="cm_consultation_id"
                                 constraintName="fk_change_consultation_status_consultation_id"
                                 referencedTableName="acm_consultation" referencedColumnNames="cm_consultation_id"
                                 deferrable="${deferrable}" initiallyDeferred="${initially.deferred}"/>
    </changeSet>

</databaseChangeLog>