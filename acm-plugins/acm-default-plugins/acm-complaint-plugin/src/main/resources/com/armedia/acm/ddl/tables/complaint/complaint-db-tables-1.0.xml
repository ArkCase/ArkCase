<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
            http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="01-create-complaint-table" author="dmiller">
        <createTable tableName="acm_complaint">
            <column name="cm_complaint_id" type="RAW(16)" defaultValueComputed="SYS_GUID()" >
                <constraints
                    primaryKey="true"
                    primaryKeyName="pk_complaint"/>
            </column>
            <column name="cm_complaint_status" type="VARCHAR(128)" defaultValue="DRAFT">
                <constraints nullable="false"/>
            </column>
            <column name="cm_complaint_created" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="cm_complaint_number" type="VARCHAR(1024)">
                <constraints nullable="false" unique="true" uniqueConstraintName="uk_complaint_number"/>
            </column>
            <column name="cm_complaint_creator" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_complaint_modified" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="cm_complaint_modifier" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_complaint_type" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_complaint_title" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_complaint_details" type="CLOB">
                <constraints nullable="false"/>
            </column>
            <column name="cm_originator_id" type="RAW(16)">
                <constraints nullable="true"/>
            </column>
            <column name="cm_target_name" type="VARCHAR(1024)">
                <constraints nullable="true"/>
            </column>
            <column name="cm_complaint_incident_date" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="true"/>
            </column>
            <column name="cm_complaint_priority" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createIndex tableName="acm_complaint" indexName="idx_complaint_originator_id">
            <column name="cm_originator_id"/>
        </createIndex>

    </changeSet>
    <changeSet id="02-complaint-switch-to-sequence-pk" author="dmiller">
        <dropDefaultValue tableName="acm_complaint" columnName="cm_complaint_id"/>
        <modifyDataType tableName="acm_complaint" columnName="cm_complaint_id" newDataType="NUMBER(32,0)"/>
    </changeSet>

    <changeSet id="04-fix-originator-id-type" author="dmiller">
        <modifyDataType tableName="acm_complaint" columnName="cm_originator_id" newDataType="NUMBER(32,0)"/>
    </changeSet>

    <changeSet id="05-drop-target-name-column" author="dmiller">
        <dropColumn tableName="acm_complaint" columnName="cm_target_name"/>
    </changeSet>

    <changeSet id="06-make-details-nullable" author="dmiller">
        <dropNotNullConstraint tableName="acm_complaint" columnName="cm_complaint_details"/>
    </changeSet>

    <changeSet id="07-add-ecm-folder-id" author="dmiller">
        <addColumn tableName="acm_complaint">
            <column name="cm_complaint_ecm_folder_id" type="VARCHAR(1024)"/>
        </addColumn>
        <createIndex tableName="acm_complaint" indexName="idx_complaint_folder_id">
            <column name="cm_complaint_ecm_folder_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="08-drop-not-null-on-priority-type-title" author="dmiller">
        <comment>Allow creating complaint with minimal data.  These columns must be populated before it can be approved.</comment>
        <dropNotNullConstraint tableName="acm_complaint" columnName="cm_complaint_type"/>
        <dropNotNullConstraint tableName="acm_complaint" columnName="cm_complaint_priority"/>
        <dropNotNullConstraint tableName="acm_complaint" columnName="cm_complaint_title"/>
    </changeSet>

    <changeSet id="09-add-priority-and-type-tables" author="dmiller">
        <createTable tableName="acm_complaint_type_lu">
            <column name="cm_id" type="NUMBER(32,0)">
                <constraints
                    nullable="false"
                    primaryKey="true"
                    primaryKeyName="pk_complaint_type"/>
            </column>
            <column name="cm_value" type="VARCHAR(4000)">
                <constraints nullable="false" unique="true" uniqueConstraintName="uk_complaint_type"/>
            </column>
            <column name="cm_order" type="NUMBER(32,0)">
                <constraints nullable="false" unique="true" uniqueConstraintName="uk_complaint_type_order"/>
            </column>
            <column name="cm_status" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_created" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="cm_creator" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_modified" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="cm_modifier" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="acm_complaint_priority_lu">
            <column name="cm_id" type="NUMBER(32,0)">
                <constraints
                    nullable="false"
                    primaryKey="true"
                    primaryKeyName="pk_complaint_priority"/>
            </column>
            <column name="cm_value" type="VARCHAR(4000)" >
                <constraints nullable="false" unique="true" uniqueConstraintName="uk_priority_type"/>
            </column>
            <column name="cm_order" type="NUMBER(32,0)">
                <constraints nullable="false" unique="true" uniqueConstraintName="uk_priority_type_order"/>
            </column>
            <column name="cm_status" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_created" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="cm_creator" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_modified" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="cm_modifier" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <insert tableName="acm_complaint_priority_lu">
            <column name="cm_id" valueComputed="SEQ_GEN_IDENTITY.NEXTVAL"/>
            <column name="cm_value" value="Low"/>
            <column name="cm_order" valueNumeric="0"/>
            <column name="cm_status" value="ACTIVE"/>
            <column name="cm_created" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_creator" valueComputed="USER"/>
            <column name="cm_modified" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_modifier" valueComputed="USER"/>
        </insert>
        <insert tableName="acm_complaint_priority_lu">
            <column name="cm_id" valueComputed="SEQ_GEN_IDENTITY.NEXTVAL"/>
            <column name="cm_value" value="Medium"/>
            <column name="cm_order" valueNumeric="1"/>
            <column name="cm_status" value="ACTIVE"/>
            <column name="cm_created" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_creator" valueComputed="USER"/>
            <column name="cm_modified" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_modifier" valueComputed="USER"/>
        </insert>
        <insert tableName="acm_complaint_priority_lu">
            <column name="cm_id" valueComputed="SEQ_GEN_IDENTITY.NEXTVAL"/>
            <column name="cm_value" value="High"/>
            <column name="cm_order" valueNumeric="2"/>
            <column name="cm_status" value="ACTIVE"/>
            <column name="cm_created" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_creator" valueComputed="USER"/>
            <column name="cm_modified" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_modifier" valueComputed="USER"/>
        </insert>
        <insert tableName="acm_complaint_priority_lu">
            <column name="cm_id" valueComputed="SEQ_GEN_IDENTITY.NEXTVAL"/>
            <column name="cm_value" value="Expedite"/>
            <column name="cm_order" valueNumeric="3"/>
            <column name="cm_status" value="ACTIVE"/>
            <column name="cm_created" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_creator" valueComputed="USER"/>
            <column name="cm_modified" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_modifier" valueComputed="USER"/>
        </insert>

        <insert tableName="acm_complaint_type_lu">
            <column name="cm_id" valueComputed="SEQ_GEN_IDENTITY.NEXTVAL"/>
            <column name="cm_value" value="Agricultural"/>
            <column name="cm_order" valueNumeric="0"/>
            <column name="cm_status" value="ACTIVE"/>
            <column name="cm_created" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_creator" valueComputed="USER"/>
            <column name="cm_modified" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_modifier" valueComputed="USER"/>
        </insert>

        <insert tableName="acm_complaint_type_lu">
            <column name="cm_id" valueComputed="SEQ_GEN_IDENTITY.NEXTVAL"/>
            <column name="cm_value" value="Arson"/>
            <column name="cm_order" valueNumeric="1"/>
            <column name="cm_status" value="ACTIVE"/>
            <column name="cm_created" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_creator" valueComputed="USER"/>
            <column name="cm_modified" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_modifier" valueComputed="USER"/>
        </insert>

        <insert tableName="acm_complaint_type_lu">
            <column name="cm_id" valueComputed="SEQ_GEN_IDENTITY.NEXTVAL"/>
            <column name="cm_value" value="Better Business Dispute"/>
            <column name="cm_order" valueNumeric="2"/>
            <column name="cm_status" value="ACTIVE"/>
            <column name="cm_created" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_creator" valueComputed="USER"/>
            <column name="cm_modified" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_modifier" valueComputed="USER"/>
        </insert>

        <insert tableName="acm_complaint_type_lu">
            <column name="cm_id" valueComputed="SEQ_GEN_IDENTITY.NEXTVAL"/>
            <column name="cm_value" value="Domestic Dispute"/>
            <column name="cm_order" valueNumeric="3"/>
            <column name="cm_status" value="ACTIVE"/>
            <column name="cm_created" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_creator" valueComputed="USER"/>
            <column name="cm_modified" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_modifier" valueComputed="USER"/>
        </insert>

        <insert tableName="acm_complaint_type_lu">
            <column name="cm_id" valueComputed="SEQ_GEN_IDENTITY.NEXTVAL"/>
            <column name="cm_value" value="Government"/>
            <column name="cm_order" valueNumeric="4"/>
            <column name="cm_status" value="ACTIVE"/>
            <column name="cm_created" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_creator" valueComputed="USER"/>
            <column name="cm_modified" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_modifier" valueComputed="USER"/>
        </insert>

        <insert tableName="acm_complaint_type_lu">
            <column name="cm_id" valueComputed="SEQ_GEN_IDENTITY.NEXTVAL"/>
            <column name="cm_value" value="Local"/>
            <column name="cm_order" valueNumeric="5"/>
            <column name="cm_status" value="ACTIVE"/>
            <column name="cm_created" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_creator" valueComputed="USER"/>
            <column name="cm_modified" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_modifier" valueComputed="USER"/>
        </insert>

        <insert tableName="acm_complaint_type_lu">
            <column name="cm_id" valueComputed="SEQ_GEN_IDENTITY.NEXTVAL"/>
            <column name="cm_value" value="Pollution"/>
            <column name="cm_order" valueNumeric="6"/>
            <column name="cm_status" value="ACTIVE"/>
            <column name="cm_created" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_creator" valueComputed="USER"/>
            <column name="cm_modified" valueComputed="SYSTIMESTAMP"/>
            <column name="cm_modifier" valueComputed="USER"/>
        </insert>
    </changeSet>

    <changeSet id="10-index-complaint-last-updated" author="dmiller">
        <createIndex tableName="acm_complaint" indexName="idx_complaint_modified">
            <column name="cm_complaint_modified"/>
        </createIndex>
    </changeSet>
    
    <changeSet id="11-insert-dueDate-in-complaint" author="tsedalu">
        <addColumn tableName="acm_complaint"> 
            <column name="cm_due_date" type="TIMESTAMP WITH TIME ZONE"/>
        </addColumn>     
    </changeSet>

    <changeSet id="12-add-fields-in-acm-complaint-table" author="tsedalu">
        <addColumn tableName="acm_complaint">
            <column name="cm_tag" type="VARCHAR(1024)"/>
            <column name="cm_frequency" type="VARCHAR(1024)"/>
            <column name="cm_location" type="VARCHAR(1024)"/>            
        </addColumn>
    </changeSet>

    <changeSet id="complaint-13-add-disposition-column" author="dmiller">
        <addColumn tableName="acm_complaint">
            <column name="cm_disposition_id" type="NUMBER(32,0)"/>
        </addColumn>
    </changeSet>

    <changeSet id="complaint-14-add-close-complaint-request-table" author="dmiller">
        <createTable tableName="acm_close_complaint_request">
            <column name="cm_close_complaint_id" type="NUMBER(32,0)">
                <constraints primaryKeyName="pk_close_complaint_request" primaryKey="true"/>
            </column>
            <column name="cm_complaint_id" type="NUMBER(32,0)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_disposition_id" type="NUMBER(32,0)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_close_complaint_status" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_close_complaint_created" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="cm_close_complaint_creator" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="cm_close_complaint_modified" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="cm_close_complaint_modifier" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint baseTableName="acm_close_complaint_request" baseColumnNames="cm_complaint_id"
                                 constraintName="fk_close_complaint_cmplnt_id"
                                 referencedTableName="acm_complaint"
                                 referencedColumnNames="cm_complaint_id"
                                 deferrable="true"
                                 initiallyDeferred="true"/>
    </changeSet>
    
    <changeSet id="complaint-15-change-location-to-address-id" author="riste.tutureski">
    	<dropColumn tableName="acm_complaint" columnName="cm_location"/>
    	<addColumn tableName="acm_complaint">
    		<column name="cm_address_id" type="NUMBER(32,0)"/>
    	</addColumn>
    </changeSet>

</databaseChangeLog>

