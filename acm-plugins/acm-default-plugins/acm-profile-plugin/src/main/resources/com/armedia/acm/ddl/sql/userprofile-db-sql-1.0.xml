<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="
            http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="userprofile-sql-01-populate-container-folder-id" author="dmiller" failOnError="false">
        <preConditions>
            <and>
                <tableExists tableName="acm_user_org"/>
                <columnExists tableName="acm_user_org" columnName="cm_container_folder_id"/>
            </and>
        </preConditions>
        <comment>ANSI standard SQL, should work on any database</comment>
        <sql>
            UPDATE acm_user_org userorg
            SET cm_container_folder_id =
                (SELECT acf.cm_container_folder_id
                 FROM   acm_container_folder acf
                 WHERE  acf.cm_object_id = userorg.cm_user_org_id
                 AND    acf.cm_object_type = 'USER_ORG')
            WHERE EXISTS
                (SELECT 1
                 FROM   acm_container_folder acf
                 WHERE  acf.cm_object_id = userorg.cm_user_org_id
                 AND    acf.cm_object_type = 'USER_ORG')
            AND  userorg.cm_container_folder_id IS NULL
        </sql>
    </changeSet>
</databaseChangeLog>