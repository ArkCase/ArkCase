<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:task="http://www.springframework.org/schema/task"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.1.xsd
       http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task-4.1.xsd">

    <!-- keeping this bean for now even though we are not using any properties yet.  -->
    <bean id="adminPluginProperties"
          class="org.springframework.beans.factory.config.PropertiesFactoryBean">
        <!-- note: must leave "file:" at the start of the file name for spring
        to be able to read the file; otherwise it will try to read from the
        classpath -->
        <property name="location" value="file:${user.home}/.arkcase/acm/adminPlugin.properties"/>
        <property name="ignoreResourceNotFound" value="true"/>
        <property name="localOverride" value="false"/>
        <property name="properties">
            <props>
            </props>
        </property>
    </bean>


    <bean id="adminPlugin" class="com.armedia.acm.pluginmanager.model.AcmPlugin">
        <property name="pluginName" value="Admin Plugin"/>
        <property name="pluginProperties" ref="adminPluginProperties"/>
    </bean>


    <bean id="labelManagementService" class="com.armedia.acm.plugins.admin.service.LabelManagementService">
        <property name="modulesLocation" value="#{ systemProperties ['user.home'] }/.arkcase/custom/modules/"/>
        <property name="moduleConfigLocation"
                  value="#{ systemProperties ['user.home'] }/.arkcase/custom/modules/%s/module_config/config.json"/>
        <property name="moduleResourcesLocation"
                  value="#{ systemProperties ['user.home'] }/.arkcase/custom/modules/%s/module_config/resources/%s.json"/>
        <property name="customResourceFile" value="%s.%s.json"/>
        <property name="customResourcesLocation"
                  value="#{ systemProperties ['user.home'] }/.arkcase/acm/resources/custom/"/>
        <property name="resourceFile" value="%s.%s.json"/>
        <property name="resourcesLocation"
                  value="#{ systemProperties ['user.home'] }/.arkcase/acm/resources/resources/"/>
        <property name="settingsFileLocation"
                  value="#{ systemProperties ['user.home'] }/.arkcase/acm/resources/settings/settings.json"/>
        <property name="baseLanguage" value="en"/>
        <property name="languages">
            <list>
                <value>en</value>
            </list>
        </property>
    </bean>

    <bean id="angularPropertiesManagementService"
          class="com.armedia.acm.plugins.admin.service.JsonPropertiesManagementService">
        <property name="propertiesFileLocation"
                  value="#{ systemProperties ['user.home'] }/.arkcase/acm/app-properties/properties.json"/>
    </bean>

    <!-- Roles Priveleges API-->
    <bean id="rolesPrivilegesService" class="com.armedia.acm.plugins.admin.web.api.RolesPrivilegesService">
        <property name="applicationRolesFile"
                  value="#{ systemProperties ['user.home'] }/.arkcase/acm/applicationRoles.properties"/>
        <property name="applicationPrivilegesFile"
                  value="#{ systemProperties ['user.home'] }/.arkcase/acm/applicationPrivileges.properties"/>
        <property name="applicationRolesPrivilegesPropertiesFile"
                  value="#{ systemProperties ['user.home'] }/.arkcase/acm/applicationRolesPrivileges.properties"/>
        <property name="applicationRolesPrivilegesTemplatesLocation"
                  value="#{ systemProperties ['user.home'] }/.arkcase/acm/spring/roles-privileges-templates/"/>
        <property name="applicationRolesPrivilegesTemplateFile" value="spring-acm-global-privileges.xml.ftl"/>
        <property name="applicationRolesPrivilegesFile"
                  value="#{ systemProperties ['user.home'] }/.arkcase/acm/spring/spring-config-acm-plugins/spring-acm-global-privileges.xml"/>
        <property name="userDao" ref="acmUserDao"/>
    </bean>

    <task:scheduler id="historyCleanScheduler" pool-size="1"/>

    <!-- How often to purge older history events. -->
    <task:scheduled-tasks scheduler="historyCleanScheduler">
        <task:scheduled ref="historyCleanJob" method="cleanHistory" cron="0 0 0/6 * * *"/>
    </task:scheduled-tasks>

    <bean id="historyCleanJob" class="com.armedia.acm.plugins.admin.service.HistoryCleanService">
        <property name="jsonPropertiesManagementService" ref="angularPropertiesManagementService"/>
        <property name="auditDao" ref="auditDao"/>
        <property name="notificationDao" ref="notificationDao"/>
    </bean>


    <bean id="cmisConfigurationService" class="com.armedia.acm.plugins.admin.service.CmisConfigurationService">
        <property name="encryptablePropertyUtils" ref="acmEncryptablePropertyUtils"/>
        <property name="cmisConfigurationTemplatesLocation"
                  value="#{ systemProperties ['user.home'] }/.arkcase/acm/cmis/cmis-config-templates/"/>
        <property name="cmisTemplateFile" value="mule-config-cmis.xml.ftl"/>
        <property name="cmisTemplatePropertiesFile" value="mule-config-cmis.properties.ftl"/>

        <property name="cmisConfigurationLocation" value="#{ systemProperties ['user.home'] }/.arkcase/acm/cmis/"/>
        <property name="cmisFile" value="mule-config-%s-cmis.xml"/>
        <property name="cmisPropertiesFile" value="mule-config-%s-cmis.properties"/>
        <property name="cmisPropertiesFileRegex" value="^mule[-d]config[-d][a-zA-Z0-9]+[-d]cmis.properties$"/>
    </bean>


    <bean id="cmisConfigurationPropertiesService"
          class="com.armedia.acm.plugins.admin.service.CmisConfigurationPropertiesService">
    </bean>

</beans>