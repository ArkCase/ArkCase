<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="
            http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="casefile-sql-01-populate-container-folder-id" author="dmiller">
        <preConditions>
            <and>
                <tableExists tableName="acm_container_folder"/>
                <columnExists tableName="acm_case_file" columnName="cm_container_folder_id"/>
            </and>
        </preConditions>
        <comment>ANSI standard SQL, should work on any database</comment>
        <sql>
            UPDATE acm_case_file casefile
            SET cm_container_folder_id =
                (SELECT acf.cm_container_folder_id
                 FROM   acm_container_folder acf
                 WHERE  acf.cm_object_id = casefile.cm_case_id
                 AND    acf.cm_object_type = 'CASE_FILE')
            WHERE EXISTS
                (SELECT 1
                 FROM   acm_container_folder acf
                 WHERE  acf.cm_object_id = casefile.cm_case_id
                 AND    acf.cm_object_type = 'CASE_FILE')
            AND  casefile.cm_container_folder_id IS NULL
        </sql>
    </changeSet>
</databaseChangeLog>